{
  "snowflake_unpivot" : {
    "name" : "snowflake_unpivot",
    "macroType" : "query",
    "definition" : "\n  \n  {{ log(\"relation: \" ~ relation, info=True) }}\n  {{ log(\"relation.db: \" ~ relation.database, info=True) }}\n  {{ log(\"relation.sc: \" ~ relation.schema, info=True) }}\n  {{ log(\"relation.id: \" ~ relation.identifier, info=True) }}\n\n  {% set cols_query %}\n    select column_name\n    from {{ relation.database }}.information_schema.columns\n    where table_schema = '{{ relation.schema.upper() }}'\n      and table_name = '{{ relation.identifier.upper() }}'\n  {% endset %}\n  {% set results = run_query(cols_query) %}\n  \n  {% if execute %} \n    {% set columns = results.columns[0].values() %}\n  {% else %}\n    {% set columns = [] %}\n  {% endif %}\n  \n  {% set unpivot_columns = [] %}\n\n  {% for col in columns %}\n    {% if col not in exclude and col not in remove %}\n      {% do unpivot_columns.append(col) %}\n    {% endif %}\n  {% endfor %}\n\n  select *\n  from {{ relation }}\n  {{ \"where \" ~ where_condition if where_condition }}\n  unpivot (\n    {{ value_name }} for {{ field_name }}\n    in ({{ unpivot_columns | join(', ') }})\n  )",
    "parameters" : {
      "type" : "record",
      "fields" : [ {
        "name" : "relation",
        "kind" : {
          "type" : "value"
        },
        "optional" : false,
        "comment" : "",
        "isWorkflowNodeConfiguration" : false,
        "isReferenced" : false
      }, {
        "name" : "field_name",
        "kind" : {
          "type" : "value",
          "value" : "'key'"
        },
        "optional" : true,
        "comment" : "",
        "isWorkflowNodeConfiguration" : false,
        "isReferenced" : false
      }, {
        "name" : "value_name",
        "kind" : {
          "type" : "value",
          "value" : "'value'"
        },
        "optional" : true,
        "comment" : "",
        "isWorkflowNodeConfiguration" : false,
        "isReferenced" : false
      }, {
        "name" : "cast_to",
        "kind" : {
          "type" : "value",
          "value" : "'string'"
        },
        "optional" : true,
        "comment" : "",
        "isWorkflowNodeConfiguration" : false,
        "isReferenced" : false
      }, {
        "name" : "exclude",
        "kind" : {
          "type" : "value",
          "value" : "['ID']"
        },
        "optional" : true,
        "comment" : "",
        "isWorkflowNodeConfiguration" : false,
        "isReferenced" : false
      }, {
        "name" : "remove",
        "kind" : {
          "type" : "value",
          "value" : "[]"
        },
        "optional" : true,
        "comment" : "",
        "isWorkflowNodeConfiguration" : false,
        "isReferenced" : false
      }, {
        "name" : "where_condition",
        "kind" : {
          "type" : "value",
          "value" : "None"
        },
        "optional" : true,
        "comment" : "",
        "isWorkflowNodeConfiguration" : false,
        "isReferenced" : false
      } ]
    },
    "staleState" : "none",
    "propertiesFile" : {
      "name" : "macros",
      "content" : "---\nversion: 2\nmacros:\n- name: \"set_query_tag_for_dataset\"\n  arguments: []\n  macroType: \"query\"\n- name: \"unpivot\"\n  arguments:\n  - name: \"parameter1\"\n    type: \"value\"\n    description: \"{\\\"ProphecyType\\\": \\\"value\\\"}\"\n  macroType: \"query\"\n- name: \"snowflake_unpivot\"\n  arguments:\n  - name: \"relation\"\n    type: \"value\"\n    description: \"{\\\"ProphecyType\\\": \\\"value\\\"}\"\n  - name: \"field_name\"\n    type: \"value\"\n    description: \"{\\\"ProphecyType\\\": \\\"value\\\"}\"\n  - name: \"value_name\"\n    type: \"value\"\n    description: \"{\\\"ProphecyType\\\": \\\"value\\\"}\"\n  - name: \"cast_to\"\n    type: \"value\"\n    description: \"{\\\"ProphecyType\\\": \\\"value\\\"}\"\n  - name: \"exclude\"\n    type: \"value\"\n    description: \"{\\\"ProphecyType\\\": \\\"value\\\"}\"\n  - name: \"remove\"\n    type: \"value\"\n    description: \"{\\\"ProphecyType\\\": \\\"value\\\"}\"\n  - name: \"where_condition\"\n    type: \"value\"\n    description: \"{\\\"ProphecyType\\\": \\\"value\\\"}\"\n  macroType: \"query\"\n",
      "path" : "br_framework/macros/macros.yml",
      "projectConfiguration" : null,
      "folderConfiguration" : {
        "version" : 2,
        "macros" : [ {
          "name" : "set_query_tag_for_dataset",
          "arguments" : [ ],
          "macroType" : "query"
        }, {
          "name" : "unpivot",
          "arguments" : [ {
            "name" : "parameter1",
            "type" : "value",
            "description" : "{\"ProphecyType\": \"value\"}"
          } ],
          "macroType" : "query"
        }, {
          "name" : "snowflake_unpivot",
          "arguments" : [ {
            "name" : "relation",
            "type" : "value",
            "description" : "{\"ProphecyType\": \"value\"}"
          }, {
            "name" : "field_name",
            "type" : "value",
            "description" : "{\"ProphecyType\": \"value\"}"
          }, {
            "name" : "value_name",
            "type" : "value",
            "description" : "{\"ProphecyType\": \"value\"}"
          }, {
            "name" : "cast_to",
            "type" : "value",
            "description" : "{\"ProphecyType\": \"value\"}"
          }, {
            "name" : "exclude",
            "type" : "value",
            "description" : "{\"ProphecyType\": \"value\"}"
          }, {
            "name" : "remove",
            "type" : "value",
            "description" : "{\"ProphecyType\": \"value\"}"
          }, {
            "name" : "where_condition",
            "type" : "value",
            "description" : "{\"ProphecyType\": \"value\"}"
          } ],
          "macroType" : "query"
        } ]
      },
      "packagesYml" : null,
      "editable" : true
    },
    "version" : 0
  }
}